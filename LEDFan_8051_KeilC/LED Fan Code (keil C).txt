// VO ANH KHA - 2013 RGB LED FAN DISPLAY
// GVHD: TS. TRUONG QUANG VINH
// Mon hoc: Thiet ke he thong nhung

#include <REGX51.H>

unsigned char code mang1[]={
// moi ki tu cao 5 hang, dai 5-7 cot, bo trong 2 hang cuoi	, MOI KI TU CACH NHAU 2 COT TRANG
0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF, //60 so FF de bat dau chay
0xC7,0x9F,0x5F,0x9F,0xC7,0xFF,0xFF,0x07,0xBF,0xDF,0xEF,0x07,0xFF, 0xFF,0x07,0xDF,0xDF,0xDF,0x07,0xFF,0xFF,0xFF, 0x07,0xDF,0x9F,0x6F,0xF7,0xFF,   //"A N H  K"	(28)
0xFF,0x07,0xDF,0xDF,0xDF,0x07,0xFF,0xFF,0xC7,0x9F,0x5F,0x9F,0xC7,0xFF,0xFF,0xFF,0xFF,     //" H A    " (16)
0xB7,0x67,0x57,0xB7,0xF7,0xFF,0x8F,0x77,0x77,0x77,0x8F,0xFF,0xB7,0x07,0xF7,0xFF,0xEF,0x77,0x57,0x57,0x07,0xFF,0xFF,0xFF,// " 2 0 1 3  " (24)
0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF, //60 so 0 de ket thuc

};
unsigned char code mang2[]={

0xC0,0xC0,0xC0,0xC0,0xFF,0xFF,0x03,0x03,0x03,0x03,0x03,0x03,0x03,0x03,0x03,0x03,0x03,0xFF,0xFF,0xC0,0xC0,0xC0,0xC0,0xC0,
0xC0,0xC0,0xC0,0xC0,0xFF,0xFF,0x03,0x03,0x03,0x03,0x03,0x03,0x03,0x03,0x03,0x03,0x03,0xFF,0xFF,0xC0,0xC0,0xC0,0xC0,0xC0,	  //(24)
0xC0,0xC0,0xC0,0xC0,0xFF,0xFF,0x03,0x03,0x03,0x03,0x03,0x03,0x03,0x03,0x03,0x03,0x03,0xFF,0xFF,0xC0,0xC0,0xC0,0xC0,0xC0,
0xC0,0xC0,0xC0,0xC0,0xFF,0xFF,0x03,0x03,0x03,0x03,0x03,0x03,0x03,0x03,0x03,0x03,0x03,0xFF,0xFF,0xC0,0xC0,0xC0,0xC0,0xC0,
0xC0,0xC0,0xC0,0xC0,0xFF,0xFF,0x03,0x03,0x03,0x03,0x03,0x03,0x03,0x03,0x03,0x03,0x03,0xFF,0xFF,0xC0,0xC0,0xC0,0xC0,0xC0,
0xC0,0xC0,0xC0,0xC0,0xFF,0xFF,0x03,0x03,0x03,0x03,0x03,0x03,0x03,0x03,0x03,0x03,0x03,0xFF,0xFF,0xC0,0xC0,0xC0,0xC0,0xC0,
0xC0,0xC0,0xC0,0xC0,0xFF,0xFF,0x03,0x03,0x03,0x03,0x03,0x03,0x03,0x03,0x03,0x03,0x03,0xFF,0xFF,0xC0,0xC0,0xC0,0xC0,0xC0,
};
unsigned char code mang3[]={

0xFF,0x81,0x6F,0x6F,0x6F,0x6F,0x9F,0xFF, //P (8)
0xFF,0xFF,0xFF,0x01,0x6F,0x6F,0x6F,0x6F,0x7F,0xFF,//F (9-18)
0xFF,0xFF,0xFF,0x7D,0x01,0x7D,0xFF, // I (19-25)
0xFF,0xFF,0xFF,0x03,0x5B,0x5B,0x5B,0x7B,0xFF,	 //E (26-34)
0xFF,0xFF,0xFF,0x1F,0xEF,0xF7,0xFB,0xF7,0xEF,0x1F,0xFF,  	  //(35-45)	" E V"

};

unsigned char code mang4[]={
0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,
0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,//120 hang tat lien tuc
0xC0,0xC0,0xC0,0xC0,0xFF,0xFF,0x03,0x03,0x03,0x03,0x03,0x03,0x03,0x03,0x03,0x03,0x03,0xFF,0xFF,0xC0,0xC0,0xC0,0xC0,0xC0,
0xC0,0xC0,0xC0,0xC0,0xFF,0xFF,0x03,0x03,0x03,0x03,0x03,0x03,0x03,0x03,0x03,0x03,0x03,0xFF,0xFF,0xC0,0xC0,0xC0,0xC0,0xC0,	  //(24)
0xC0,0xC0,0xC0,0xC0,0xFF,0xFF,0x03,0x03,0x03,0x03,0x03,0x03,0x03,0x03,0x03,0x03,0x03,0xFF,0xFF,0xC0,0xC0,0xC0,0xC0,0xC0,
0xC0,0xC0,0xC0,0xC0,0xFF,0xFF,0x03,0x03,0x03,0x03,0x03,0x03,0x03,0x03,0x03,0x03,0x03,0xFF,0xFF,0xC0,0xC0,0xC0,0xC0,0xC0,
0xC0,0xC0,0xC0,0xC0,0xFF,0xFF,0x03,0x03,0x03,0x03,0x03,0x03,0x03,0x03,0x03,0x03,0x03,0xFF,0xFF,0xC0,0xC0,0xC0,0xC0,0xC0,
0xC0,0xC0,0xC0,0xC0,0xFF,0xFF,0x03,0x03,0x03,0x03,0x03,0x03,0x03,0x03,0x03,0x03,0x03,0xFF,0xFF,0xC0,0xC0,0xC0,0xC0,0xC0,
0xC0,0xC0,0xC0,0xC0,0xFF,0xFF,0x03,0x03,0x03,0x03,0x03,0x03,0x03,0x03,0x03,0x03,0x03,0xFF,0xFF,0xC0,0xC0,0xC0,0xC0,0xC0,
0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,
0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,//120 hang tat lien tuc
};

//================================================== =======
unsigned char j,m,buoc=1;			 //chinh lai buoc=0 sau khi hoan thanh code
unsigned int i,k,d=1;
void ngat_timer0(void) interrupt 1 using 1
{

TH0=0xFD;
TL0=0x12;
}
//================================================== ======
void ISR0 (void) interrupt 0 using 2
{
TH0=0xFD;
TL0=0x12;
TR0=1;

switch (buoc)

	{

case 1:
	for(i=k;i<55+k;i++)    //hien thi 55 cot (chay chu)
	{
	j=20;			 //thoi gian 1 cot sang
	while(j--)
	{
	P2=mang1[i]; P0=mang1[i];
	}
	m=4;			   // thoi gian 1 cot tat sau khi sang
	while(m--)
	{
	P2=0xFF; P0=0xFF; P1=0XFF;
	}
	}
	if (d==0)
	{ k++; d=1; } else {d--;}

	if(k==130)	//  (tong cong chieu dai ma tran - chieu dai hien thi = 184-55)
	{
	P2=0xFF; P1=0xFF;P0=0xFF; k=0; buoc++; // dung de hien thi ma code khac
	}
	break;
case 2:
	for(i=0;i<k;i++)
	{
	j=20;
	while(j--)
		{P2=~mang2[i];}

	}
// P1=0xff;
	k++;
	if(k==130)
	{k=0; P2=0xFF; P1=0xFF;P0=0xFF;buoc++; // dung de hien thi ma code khac
	}
break;

case 3:
	for(i=0;i<9;i++)
	{
	j=20;
	while(j--)
		{P0=mang3[i];}
	P0=0xFF;
	}	 // hien xong chu "P"


	for(i=9;i<19;i++)
	{
	j=20;
	while(j--)
		{P1=mang3[i];}
		P1=0xFF;
	}	 // hien xong chu "F"


		for(i=19;i<26;i++)
	{
	j=20;
	while(j--)
		{P2=mang3[i];}
		P2=0xFF;
	}	   // hien xong chu "I"


		for(i=26;i<35;i++)
	{
	j=20;
	while(j--)
		{P2=mang3[i];P1=mang3[i];}
		P2=0xFF; P1=0xFF;
	}	// hien xong chu "E"

			for(i=35;i<45;i++)
	{
	j=20;
	while(j--)
		{P0=mang3[i];P1=mang3[i];}
		P0=0xFF; P1=0xFF;
	}	// hien xong chu "V"
	k++;
	if(k==200)
	{k=0; P2=0xFF; P1=0xFF;P0=0XFF;buoc++; // dung de hien thi ma code khac
	}
break;

   case 4:
	for(i=k;i<70+k;i++)
	{
	j=20;
	while(j--)
		{P1=~mang4[i];P0=~mang4[i];}

	}
// P1=0xff;
	k++;
	if(k==264)
	{k=0; P2=0xFF; P1=0xFF;P0=0xFF;buoc++; // dung de hien thi ma code khac
	}
break;

default:
{buoc=1; k=0;}
break;
}
}

//================================================== ====
/*void delay(unsigned char a)
{
while(a--)
{
unsigned char b=120;
while(b--);
}
} */
//================================================== ==
void main()
{
	TMOD=1;
	P1=0xff; P0=0xff; P2=0Xff; EA=1; EX0=1; ET0=1;
	while(1)
{
//delay(500);
}
}